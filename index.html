<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIBORG347 | Generador de Presupuestos PDF</title>
  <style>
    :root{
      --bg:#07090f;
      --panel:#0e1320;
      --panel2:#121a2b;
      --line:#273149;
      --text:#ecf2fb;
      --muted:#9fb0c8;
      --c1:#00d4ff;
      --c2:#7c3aed;
      --ok:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --white:#fff;
      --a4w:210mm;
      --a4h:297mm;
      --radius:14px;
      --mono: Consolas, "Courier New", monospace;
      --sans: Inter, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{background:var(--bg);color:var(--text);font-family:var(--sans)}
    body{padding:14px}
    a{color:inherit}

    .app{
      max-width:1480px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:14px;
      align-items:start;
    }

    .panel{
      background:linear-gradient(180deg,var(--panel2),var(--panel));
      border:1px solid #1f2740;
      border-radius:16px;
      padding:12px;
      position:sticky;
      top:10px;
      box-shadow:0 12px 26px rgba(0,0,0,.22);
    }

    .brand-mini{
      display:flex;gap:10px;align-items:center;
      background:#0b1020;border:1px solid #202942;border-radius:12px;padding:8px 10px;
      margin-bottom:10px;
    }
    .brand-mini img{
      width:38px;height:38px;border-radius:10px;object-fit:cover;background:#0b1220;border:1px solid #25304a;
    }
    .brand-mini .t1{font-weight:800;font-size:.95rem;letter-spacing:.2px}
    .brand-mini .t2{color:var(--muted);font-size:.75rem}

    .panel h1{
      font-size:1rem; line-height:1.2; margin-bottom:4px; color:#fff;
    }
    .panel .sub{
      color:var(--muted); font-size:.82rem; line-height:1.3; margin-bottom:10px;
    }

    .quick-grid{display:grid;gap:8px}
    .row-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}

    .field{display:grid;gap:4px}
    .field label{
      font-size:.75rem;
      color:#c6d4e6;
      font-weight:700;
      letter-spacing:.3px;
    }
    .field input,.field textarea,.field select{
      width:100%;
      border-radius:10px;
      border:1px solid #28324b;
      background:#0a1020;
      color:#eef4ff;
      padding:10px 11px;
      font-size:.9rem;
      outline:none;
    }
    .field textarea{
      min-height:82px;
      resize:vertical;
      line-height:1.35;
    }
    .field input:focus,.field textarea:focus,.field select:focus{
      border-color:#3b82f6;
      box-shadow:0 0 0 3px rgba(59,130,246,.14);
    }

    .actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      margin-top:10px;
    }
    .actions-3{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:8px;
      margin-top:8px;
    }

    button{
      border:none;
      border-radius:10px;
      padding:10px 10px;
      font-weight:800;
      font-size:.86rem;
      cursor:pointer;
      transition:transform .12s ease, opacity .12s ease;
    }
    button:hover{opacity:.95}
    button:active{transform:scale(.985)}

    .btn-primary{color:#fff;background:linear-gradient(90deg,var(--c1),var(--c2))}
    .btn-dark{color:#d8e5f5;background:#121a2b;border:1px solid #29344f}
    .btn-green{color:#fff;background:linear-gradient(90deg,#16a34a,#22c55e)}
    .btn-orange{color:#111827;background:linear-gradient(90deg,#fbbf24,#f59e0b)}

    details.advanced{
      margin-top:10px;
      border:1px solid #202a43;
      border-radius:12px;
      background:#0b1020;
      overflow:hidden;
    }
    details.advanced summary{
      list-style:none;
      cursor:pointer;
      padding:10px 12px;
      font-weight:800;
      font-size:.88rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:#eaf1fb;
      background:linear-gradient(180deg,#101829,#0c1220);
      border-bottom:1px solid transparent;
    }
    details.advanced[open] summary{
      border-bottom-color:#1d2740;
    }
    details.advanced summary::-webkit-details-marker{display:none}
    .adv-content{padding:10px;display:grid;gap:8px}
    .hint{color:var(--muted);font-size:.76rem;line-height:1.25}
    .status{
      margin-top:10px;
      min-height:18px;
      font-size:.82rem;
      color:#c6d4e6;
      line-height:1.3;
    }
    .status.ok{color:#a7f3d0}
    .status.warn{color:#fde68a}
    .status.err{color:#fecaca}

    .preview-shell{
      background:linear-gradient(180deg,var(--panel2),var(--panel));
      border:1px solid #1f2740;
      border-radius:16px;
      padding:12px;
      box-shadow:0 12px 26px rgba(0,0,0,.22);
      overflow:auto;
    }

    .preview-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:8px;
      color:var(--muted);
      font-family:var(--mono);
      font-size:11px;
    }
    .pill{
      display:inline-flex;align-items:center;gap:6px;
      border:1px solid #2a3552;background:#0b1220;border-radius:999px;
      padding:4px 8px;font-size:11px;color:#dbe7f6;
    }
    .dot{width:8px;height:8px;border-radius:50%;background:var(--ok)}

    /* ===== DOCUMENTO / HOJAS ===== */
    .doc-wrap{
      display:grid;
      gap:10px;
      justify-items:center;
    }

    .sheet{
      width:var(--a4w);
      min-height:var(--a4h);
      background:#070b14;
      border:1px solid #13203a;
      box-shadow:0 18px 40px rgba(0,0,0,.28);
      position:relative;
      overflow:hidden;
      isolation:isolate;
      color:#edf4fd;
      page-break-inside:avoid;
      break-inside:avoid;
    }

    .sheet::before{
      content:"";
      position:absolute; inset:0; z-index:0; pointer-events:none;
      background:
        radial-gradient(circle at 12% 0%, rgba(0,212,255,.13), transparent 36%),
        radial-gradient(circle at 100% 0%, rgba(124,58,237,.10), transparent 34%),
        linear-gradient(180deg, rgba(255,255,255,.015), rgba(255,255,255,0));
    }

    .topbar{
      height:4px;
      background:linear-gradient(90deg,var(--c1),#2563eb,var(--c2),#ec4899);
      position:relative; z-index:2;
    }

    .watermark{
      position:absolute; inset:0; z-index:1; pointer-events:none;
      display:flex; align-items:center; justify-content:center;
      opacity:.08; transform:rotate(-14deg) scale(1.05);
      filter:grayscale(100%) contrast(115%);
    }
    .watermark img{
      width:70%; max-width:540px; height:auto; object-fit:contain;
    }

    .sheet-inner{
      position:relative; z-index:2;
      padding:8mm 8mm 7mm;
      min-height:calc(var(--a4h) - 4px);
      display:flex; flex-direction:column; gap:7px;
    }

    .header{
      display:grid; grid-template-columns:86px 1fr; gap:10px;
      border-bottom:1px solid rgba(39,49,73,.9);
      padding-bottom:7px;
      align-items:start;
    }
    .logoBox{
      width:86px;height:86px;border-radius:10px;
      border:1px solid #273149;background:#0b1020;overflow:hidden;
    }
    .logoBox img{width:100%;height:100%;object-fit:cover}
    .headerText{
      min-height:86px;
      display:flex; flex-direction:column; justify-content:flex-end; gap:4px;
    }
    .micro{
      font-family:var(--mono); font-size:10px; color:#91a6bf; letter-spacing:.9px; text-transform:uppercase;
    }
    .title{
      font-family:var(--mono); font-weight:900; font-size:27px; line-height:1;
      color:#89e5ff; text-transform:uppercase; letter-spacing:.7px;
      text-shadow:0 0 14px rgba(0,212,255,.14);
    }
    .metaRow{
      display:flex; flex-wrap:wrap; gap:8px 14px;
      font-family:var(--mono); font-size:11px; color:#b6c8dd; text-transform:uppercase;
    }
    .metaRow strong{color:#fff}

    .cards2{
      display:grid; grid-template-columns:1fr 1fr; gap:7px;
    }
    .card{
      border:1px solid #273149;
      background:linear-gradient(180deg,rgba(10,16,32,.95),rgba(7,12,23,.95));
      border-radius:12px; padding:9px 11px;
    }
    .card .lab{
      color:#b79cff;
      font-family:var(--mono);
      font-size:10px; letter-spacing:1px; text-transform:uppercase; font-weight:800;
      margin-bottom:5px;
    }
    .card .val{
      font-family:var(--mono);
      color:#f1f6fc;
      font-size:16px;
      line-height:1.15;
      word-break:break-word;
      text-transform:uppercase;
    }
    .card .val.total{
      color:#98f5b2; font-weight:900; font-size:20px;
    }

    .serviceBox{
      border:1px solid #273149;
      border-radius:12px;
      overflow:hidden;
      background:linear-gradient(180deg,rgba(9,15,28,.96),rgba(6,10,20,.96));
    }
    .serviceHead{
      display:grid; grid-template-columns:1fr 110px; gap:8px;
      padding:8px 11px;
      border-bottom:1px solid #273149;
      font-family:var(--mono); font-size:10px; color:#97acc4; text-transform:uppercase; letter-spacing:1px;
    }
    .serviceRow{
      display:grid; grid-template-columns:1fr 110px; gap:0;
      align-items:start;
    }
    .serviceMain{
      padding:8px 11px 7px;
      border-right:1px solid #273149;
    }
    .serviceTitle{
      color:#85e7ff;
      font-family:var(--mono); font-size:13px; font-weight:900;
      letter-spacing:.35px; text-transform:uppercase; line-height:1.15;
      margin-bottom:5px;
    }
    .bullets{
      padding-left:15px;
      color:#c7d5e6;
      font-family:var(--mono); font-size:10.6px; line-height:1.16;
    }
    .bullets li{margin:1px 0}
    .servicePrice{
      padding:9px 10px;
      text-align:right;
      font-family:var(--mono);
      font-size:12px;
      color:#eef4fb;
      font-weight:800;
      white-space:nowrap;
    }

    .miniGrid{
      display:grid; grid-template-columns:1fr 1fr; gap:7px;
    }
    .mini{
      border:1px solid #273149;
      border-radius:12px;
      padding:8px 10px;
      background:linear-gradient(180deg,rgba(10,16,32,.95),rgba(7,12,23,.95));
    }
    .mini .mLab{
      color:#cddcf0;
      font-family:var(--mono); font-size:10px; letter-spacing:1px; text-transform:uppercase; font-weight:800;
      margin-bottom:5px;
    }
    .mini .mVal{
      color:#becfe2;
      font-family:var(--mono); font-size:10.6px; line-height:1.15; word-break:break-word;
    }

    .obsBox{
      border:1px solid #273149;
      border-radius:12px;
      padding:8px 10px;
      background:linear-gradient(180deg,rgba(9,15,28,.95),rgba(7,11,21,.95));
    }
    .obsTitle{
      color:#dde9f7;
      font-family:var(--mono); font-size:10px; text-transform:uppercase; letter-spacing:1px; font-weight:800;
      margin-bottom:5px;
    }
    .obsLines{display:grid;gap:3px}
    .obsLine{
      min-height:15px;
      border-bottom:1px dashed rgba(159,176,198,.33);
      color:#b9c9da;
      font-family:var(--mono); font-size:10px; line-height:1.1;
      display:flex; align-items:flex-end; padding-bottom:1px;
      word-break:break-word;
    }

    /* ===== cierre fijo de boleta ===== */
    .footerClose{
      margin-top:auto;
      border-top:1px solid #273149;
      padding-top:6px;
      display:grid;
      gap:5px;
      page-break-inside:avoid;
      break-inside:avoid;
    }
    .fRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:8px;
      align-items:center;
    }
    .fText{
      color:#c4d4e5;
      font-family:var(--mono);
      font-size:10px;
      line-height:1.12;
    }
    .fText .tag{
      color:#c49bff;
      font-weight:900;
      text-transform:uppercase;
    }
    .chips{
      display:flex; flex-wrap:wrap; gap:5px; justify-content:flex-end;
      max-width:40%;
    }
    .chip{
      border:1px solid #dbe6f6;
      background:#ffffff;
      color:#0f172a;
      border-radius:999px;
      padding:3px 7px;
      font-size:10px;
      font-weight:800;
      display:inline-flex; align-items:center; gap:5px;
      min-height:22px;
      white-space:nowrap;
    }
    .chipDot{
      width:12px;height:12px;border-radius:50%;display:inline-grid;place-items:center;
      color:#fff;font-size:8px;font-weight:900;
    }
    .chipDot.wa{background:#22c55e}
    .chipDot.ig{background:#ec4899}

    .legal{
      color:#8fa5bf;
      font-family:var(--mono);
      font-size:9px;
      line-height:1.1;
    }

    .signature{
      border-top:1px solid rgba(39,49,73,.55);
      padding-top:4px;
      text-align:center;
      color:#8ea3bc;
      font-family:var(--mono);
      font-size:9.4px;
      letter-spacing:.8px;
      text-transform:uppercase;
    }

    /* segunda pagina contenido extendido */
    .sheet.extended .header .title::after{
      content:" / CONTINUACION";
      font-size:13px;
      color:#d0c2ff;
    }
    .ext-block{
      border:1px solid #273149; border-radius:12px; overflow:hidden;
      background:linear-gradient(180deg,rgba(9,15,28,.95),rgba(6,10,20,.95));
    }
    .ext-head{
      padding:8px 10px; border-bottom:1px solid #273149;
      font-family:var(--mono); font-size:10px; color:#97acc4; letter-spacing:1px; text-transform:uppercase;
    }
    .ext-body{
      padding:10px;
      color:#c8d6e8;
      font-family:var(--mono);
      font-size:11px;
      line-height:1.3;
      white-space:pre-wrap;
      word-break:break-word;
    }

    @media (max-width:1100px){
      .app{grid-template-columns:1fr}
      .panel{position:static}
    }

    @media (max-width:720px){
      body{padding:10px}
      .cards2,.miniGrid,.row-2,.row-3,.actions,.actions-3{grid-template-columns:1fr}
      .preview-head{flex-wrap:wrap}
    }

    /* PRINT */
    @page{
      size:A4 portrait;
      margin:6mm;
    }
    @media print{
      html,body{
        background:#fff !important;
        margin:0 !important;
        padding:0 !important;
      }
      .app{display:block !important; max-width:none !important;}
      .panel{display:none !important}
      .preview-shell{
        background:transparent !important;
        border:none !important;
        box-shadow:none !important;
        padding:0 !important;
        overflow:visible !important;
      }
      .preview-head{display:none !important}
      .doc-wrap{gap:8mm !important}
      .sheet{
        width:198mm !important;
        min-height:285mm !important;
        box-shadow:none !important;
        margin:0 auto !important;
      }
      .sheet-inner{
        min-height:calc(285mm - 4px) !important;
        padding:7.5mm 7.5mm 6.5mm !important;
      }
      .sheet, .header, .cards2, .serviceBox, .miniGrid, .obsBox, .footerClose{
        page-break-inside:avoid !important;
        break-inside:avoid !important;
      }
      .watermark{opacity:.07 !important}
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- PANEL SIMPLE -->
    <aside class="panel">
      <div class="brand-mini">
        <img id="miniBrandLogo" src="https://iili.io/qFelkJt.jpg" alt="CIBORG" />
        <div>
          <div class="t1">CIBORG347 | Generador PDF</div>
          <div class="t2">Modo CIBORG (simple + pro)</div>
        </div>
      </div>

      <h1>Presupuesto rapido (Modo CIBORG)</h1>
      <p class="sub">
        Carga lo basico y genera PDF. Si necesitas mas detalle, abri <strong>Opciones avanzadas</strong>.
      </p>

      <div class="quick-grid">
        <div class="field">
          <label for="docTypeFriendly">Tipo de documento</label>
          <select id="docTypeFriendly">
            <option value="simple">Presupuesto simple</option>
            <option value="tecnico">Boleta tecnica / detallada</option>
          </select>
        </div>

        <div class="row-2">
          <div class="field">
            <label for="fecha">Fecha</label>
            <input id="fecha" type="text" value="23/02/2026" />
          </div>
          <div class="field">
            <label for="nro">Nro</label>
            <input id="nro" type="text" value="C347-001" />
          </div>
        </div>

        <div class="field">
          <label for="cliente">Cliente</label>
          <input id="cliente" type="text" value="Nombre del cliente" />
        </div>

        <div class="field">
          <label for="servicioTitulo">Servicio / trabajo</label>
          <input id="servicioTitulo" type="text" value="Creacion de sitio web full responsive" />
        </div>

        <div class="row-2">
          <div class="field">
            <label for="inversion">Inversion final</label>
            <input id="inversion" type="text" value="$ 120.000 ARS" />
          </div>
          <div class="field">
            <label for="valorServicio">Valor servicio</label>
            <input id="valorServicio" type="text" value="$ 120.000 ARS" />
          </div>
        </div>

        <div class="field">
          <label for="bullets">Que incluye (1 linea por item)</label>
          <textarea id="bullets">Diseño personalizado de la web
Version responsive (celular y PC)
Boton flotante de WhatsApp
Carga inicial de textos e imagenes
Ajustes finales de presentacion
Entrega lista para usar</textarea>
        </div>

        <div class="field">
          <label for="obsResumen">Observaciones (resumen corto)</label>
          <textarea id="obsResumen">Se abona una vez entregado el sitio. Se puede ajustar contenido o secciones segun necesidad final.</textarea>
        </div>

        <div class="actions">
          <button class="btn-primary" id="btnPrint">Imprimir / Guardar PDF</button>
          <button class="btn-dark" id="btnShare">Compartir</button>
        </div>
        <div class="actions-3">
          <button class="btn-dark" id="btnDownloadHtml">Descargar HTML</button>
          <button class="btn-dark" id="btnReset">Reset</button>
          <button class="btn-orange" id="btnLoadCiborg">Modo CIBORG</button>
        </div>
      </div>

      <!-- OPCIONES AVANZADAS -->
      <details class="advanced" id="advPanel">
        <summary>
          <span>Opciones avanzadas</span>
          <span id="advLabel">abrir</span>
        </summary>
        <div class="adv-content">
          <div class="hint">
            Aca podes convertirlo en una boleta mas tecnica, controlar hojas, marca de agua y datos de cierre.
          </div>

          <div class="field">
            <label for="logoUrl">Imagen CIBORG / logo (tambien marca de agua)</label>
            <input id="logoUrl" type="text" value="https://iili.io/qFelkJt.jpg" />
          </div>

          <div class="row-2">
            <div class="field">
              <label for="tituloDoc">Titulo visible</label>
              <input id="tituloDoc" type="text" value="Presupuesto" />
            </div>
            <div class="field">
              <label for="sheetMode">Modo de hojas</label>
              <select id="sheetMode">
                <option value="auto" selected>Auto (1 pagina si entra)</option>
                <option value="one">Forzar 1 pagina</option>
                <option value="two">Permitir 2 paginas</option>
              </select>
            </div>
          </div>

          <div class="row-2">
            <div class="field">
              <label for="compactMode">Compactacion</label>
              <select id="compactMode">
                <option value="smart" selected>Inteligente (recomendado)</option>
                <option value="compact">Mas compacta</option>
                <option value="normal">Normal</option>
              </select>
            </div>
            <div class="field">
              <label for="watermarkToggle">Marca de agua</label>
              <select id="watermarkToggle">
                <option value="on" selected>Mostrar</option>
                <option value="off">Ocultar</option>
              </select>
            </div>
          </div>

          <div class="row-2">
            <div class="field">
              <label for="tiempo">Tiempo estimado</label>
              <input id="tiempo" type="text" value="A coordinar segun contenido final" />
            </div>
            <div class="field">
              <label for="vigencia">Vigencia</label>
              <input id="vigencia" type="text" value="7 dias" />
            </div>
          </div>

          <div class="field">
            <label for="modalidad">Modalidad de pago</label>
            <input id="modalidad" type="text" value="Se abona una vez entregado el sitio / transferencia o MP" />
          </div>

          <div class="row-2">
            <div class="field">
              <label for="whatsapp">WhatsApp</label>
              <input id="whatsapp" type="text" value="11 6449-9481" />
            </div>
            <div class="field">
              <label for="instagram">Instagram</label>
              <input id="instagram" type="text" value="@ciborg347" />
            </div>
          </div>

          <div class="field">
            <label for="legal">Texto legal</label>
            <input id="legal" type="text" value="Esta propuesta puede ajustarse segun cambios de alcance, contenido o funcionalidades solicitadas." />
          </div>

          <div class="field">
            <label for="firma">Firma de cierre</label>
            <input id="firma" type="text" value="CIBORG347 // DISENO QUE CONVIERTE VISITAS EN CLIENTES" />
          </div>

          <div class="field">
            <label for="extraDetalle">Detalle tecnico extra (si queres 2da hoja)</label>
            <textarea id="extraDetalle" placeholder="Aca podes poner detalle largo, condiciones, lista de extras, direccion de envio, quien recibe, etc. Si no entra en 1 hoja y esta en Auto, te avisa. Si permitis 2 paginas, lo manda a hoja 2."></textarea>
          </div>

          <div class="row-3">
            <div class="field">
              <label for="obs1">Observacion 1</label>
              <input id="obs1" type="text" value="" />
            </div>
            <div class="field">
              <label for="obs2">Observacion 2</label>
              <input id="obs2" type="text" value="" />
            </div>
            <div class="field">
              <label for="obs3">Observacion 3</label>
              <input id="obs3" type="text" value="" />
            </div>
          </div>
        </div>
      </details>

      <div id="status" class="status">Listo. Genera PDF cuando quieras.</div>
    </aside>

    <!-- VISTA PREVIA -->
    <section class="preview-shell">
      <div class="preview-head">
        <div class="pill"><span class="dot" id="dotMode"></span><span id="badgeMode">1 pagina (auto)</span></div>
        <div id="previewMeta">Vista previa A4 | Modo CIBORG</div>
      </div>

      <div class="doc-wrap" id="docWrap">
        <!-- Hoja 1 -->
        <div class="sheet" id="sheet1">
          <div class="topbar"></div>

          <div class="watermark" id="watermark1">
            <img id="wmImg1" src="https://iili.io/qFelkJt.jpg" alt="" />
          </div>

          <div class="sheet-inner" id="sheetInner1">
            <header class="header">
              <div class="logoBox">
                <img id="pvLogo1" src="https://iili.io/qFelkJt.jpg" alt="Logo" />
              </div>
              <div class="headerText">
                <div class="micro" id="pvMicro">PROPUESTA COMERCIAL / PRESUPUESTO FORMAL</div>
                <div class="title" id="pvTituloDoc">PRESUPUESTO</div>
                <div class="metaRow">
                  <span>FECHA: <strong id="pvFecha">23/02/2026</strong></span>
                  <span>NRO: <strong id="pvNro">C347-001</strong></span>
                </div>
              </div>
            </header>

            <section class="cards2">
              <div class="card">
                <div class="lab">Cliente</div>
                <div class="val" id="pvCliente">NOMBRE DEL CLIENTE</div>
              </div>
              <div class="card">
                <div class="lab">Inversion final</div>
                <div class="val total" id="pvInversion">$ 120.000 ARS</div>
              </div>
            </section>

            <section class="serviceBox">
              <div class="serviceHead">
                <div id="serviceHeadText">DETALLE DEL SERVICIO / ALCANCE</div>
                <div style="text-align:right">VALOR</div>
              </div>
              <div class="serviceRow">
                <div class="serviceMain">
                  <div class="serviceTitle" id="pvServicioTitulo">CREACION DE SITIO WEB FULL RESPONSIVE</div>
                  <ul class="bullets" id="pvBullets"></ul>
                </div>
                <div class="servicePrice" id="pvValorServicio">$ 120.000 ARS</div>
              </div>
            </section>

            <section class="miniGrid">
              <div class="mini">
                <div class="mLab">Tiempo estimado</div>
                <div class="mVal" id="pvTiempo">A coordinar segun contenido final</div>
              </div>
              <div class="mini">
                <div class="mLab">Vigencia</div>
                <div class="mVal" id="pvVigencia">7 dias</div>
              </div>
            </section>

            <section class="obsBox">
              <div class="obsTitle" id="pvObsTitle">OBSERVACIONES / DETALLES</div>
              <div class="obsLines">
                <div class="obsLine" id="pvObsLine1"></div>
                <div class="obsLine" id="pvObsLine2"></div>
                <div class="obsLine" id="pvObsLine3"></div>
              </div>
            </section>

            <!-- CIERRE DE BOLETA -->
            <footer class="footerClose" id="footerClose1">
              <div class="fRow">
                <div class="fText"><span class="tag">MODALIDAD:</span> <span id="pvModalidad">Se abona una vez entregado el sitio / transferencia o MP</span></div>
                <div class="chips">
                  <div class="chip"><span class="chipDot wa">W</span><span id="pvWhatsapp">11 6449-9481</span></div>
                  <div class="chip"><span class="chipDot ig">IG</span><span id="pvInstagram">@ciborg347</span></div>
                </div>
              </div>
              <div class="legal" id="pvLegal">Esta propuesta puede ajustarse segun cambios de alcance, contenido o funcionalidades solicitadas.</div>
              <div class="signature" id="pvFirma">CIBORG347 // DISENO QUE CONVIERTE VISITAS EN CLIENTES</div>
            </footer>
          </div>
        </div>

        <!-- Hoja 2 (oculta por defecto) -->
        <div class="sheet extended" id="sheet2" style="display:none;">
          <div class="topbar"></div>
          <div class="watermark" id="watermark2">
            <img id="wmImg2" src="https://iili.io/qFelkJt.jpg" alt="" />
          </div>
          <div class="sheet-inner">
            <header class="header">
              <div class="logoBox">
                <img id="pvLogo2" src="https://iili.io/qFelkJt.jpg" alt="Logo" />
              </div>
              <div class="headerText">
                <div class="micro">DOCUMENTO COMPLEMENTARIO / DETALLE TECNICO</div>
                <div class="title" id="pvTituloDoc2">PRESUPUESTO</div>
                <div class="metaRow">
                  <span>CLIENTE: <strong id="pvCliente2">NOMBRE DEL CLIENTE</strong></span>
                  <span>NRO: <strong id="pvNro2">C347-001</strong></span>
                </div>
              </div>
            </header>

            <section class="ext-block">
              <div class="ext-head">DETALLE TECNICO / CONDICIONES / CAMPOS ADICIONALES</div>
              <div class="ext-body" id="pvExtraDetalle"></div>
            </section>

            <footer class="footerClose">
              <div class="fRow">
                <div class="fText"><span class="tag">MODALIDAD:</span> <span id="pvModalidad2">Se abona una vez entregado el sitio / transferencia o MP</span></div>
                <div class="chips">
                  <div class="chip"><span class="chipDot wa">W</span><span id="pvWhatsapp2">11 6449-9481</span></div>
                  <div class="chip"><span class="chipDot ig">IG</span><span id="pvInstagram2">@ciborg347</span></div>
                </div>
              </div>
              <div class="legal" id="pvLegal2">Esta propuesta puede ajustarse segun cambios de alcance, contenido o funcionalidades solicitadas.</div>
              <div class="signature" id="pvFirma2">CIBORG347 // DISENO QUE CONVIERTE VISITAS EN CLIENTES</div>
            </footer>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    (() => {
      const $ = (id) => document.getElementById(id);

      // Campos principales
      const fields = {
        docTypeFriendly: $("docTypeFriendly"),
        fecha: $("fecha"),
        nro: $("nro"),
        cliente: $("cliente"),
        servicioTitulo: $("servicioTitulo"),
        inversion: $("inversion"),
        valorServicio: $("valorServicio"),
        bullets: $("bullets"),
        obsResumen: $("obsResumen"),

        // avanzados
        logoUrl: $("logoUrl"),
        tituloDoc: $("tituloDoc"),
        sheetMode: $("sheetMode"),
        compactMode: $("compactMode"),
        watermarkToggle: $("watermarkToggle"),
        tiempo: $("tiempo"),
        vigencia: $("vigencia"),
        modalidad: $("modalidad"),
        whatsapp: $("whatsapp"),
        instagram: $("instagram"),
        legal: $("legal"),
        firma: $("firma"),
        extraDetalle: $("extraDetalle"),
        obs1: $("obs1"),
        obs2: $("obs2"),
        obs3: $("obs3"),
      };

      const defaults = {};
      Object.keys(fields).forEach(k => defaults[k] = fields[k].value);

      // Vista previa refs
      const pv = {
        miniBrandLogo: $("miniBrandLogo"),
        logo1: $("pvLogo1"),
        logo2: $("pvLogo2"),
        wm1: $("wmImg1"),
        wm2: $("wmImg2"),
        watermark1: $("watermark1"),
        watermark2: $("watermark2"),

        titulo1: $("pvTituloDoc"),
        titulo2: $("pvTituloDoc2"),
        fecha: $("pvFecha"),
        nro: $("pvNro"),
        nro2: $("pvNro2"),
        cliente: $("pvCliente"),
        cliente2: $("pvCliente2"),
        inversion: $("pvInversion"),
        servicioTitulo: $("pvServicioTitulo"),
        bullets: $("pvBullets"),
        valorServicio: $("pvValorServicio"),
        tiempo: $("pvTiempo"),
        vigencia: $("pvVigencia"),

        obsLine1: $("pvObsLine1"),
        obsLine2: $("pvObsLine2"),
        obsLine3: $("pvObsLine3"),

        modalidad: $("pvModalidad"),
        modalidad2: $("pvModalidad2"),
        whatsapp: $("pvWhatsapp"),
        whatsapp2: $("pvWhatsapp2"),
        instagram: $("pvInstagram"),
        instagram2: $("pvInstagram2"),
        legal: $("pvLegal"),
        legal2: $("pvLegal2"),
        firma: $("pvFirma"),
        firma2: $("pvFirma2"),
        extraDetalle: $("pvExtraDetalle"),

        badgeMode: $("badgeMode"),
        dotMode: $("dotMode"),
        previewMeta: $("previewMeta"),
        serviceHeadText: $("serviceHeadText"),

        sheet1: $("sheet1"),
        sheet2: $("sheet2"),
        sheetInner1: $("sheetInner1"),
        footerClose1: $("footerClose1"),

        status: $("status"),
        advPanel: $("advPanel"),
        advLabel: $("advLabel"),
      };

      // botones
      const btnPrint = $("btnPrint");
      const btnShare = $("btnShare");
      const btnDownloadHtml = $("btnDownloadHtml");
      const btnReset = $("btnReset");
      const btnLoadCiborg = $("btnLoadCiborg");

      function setStatus(msg, type=""){
        pv.status.className = "status" + (type ? " " + type : "");
        pv.status.textContent = msg || "";
      }

      function upperSafe(v){
        return String(v || "").toUpperCase();
      }

      function safeText(v, fallback="-"){
        const s = String(v ?? "").trim();
        return s || fallback;
      }

      function splitLines(txt){
        return String(txt || "")
          .split(/\n+/)
          .map(s => s.trim())
          .filter(Boolean);
      }

      function applyBullets(){
        const mode = fields.compactMode.value;
        const type = fields.docTypeFriendly.value;
        let maxItems = 6;
        if (mode === "compact") maxItems = 5;
        if (mode === "normal") maxItems = 8;
        if (type === "tecnico" && mode !== "compact") maxItems = 9;

        let items = splitLines(fields.bullets.value);
        if (!items.length) items = ["Detalle del servicio a definir"];
        const visible = items.slice(0, maxItems);
        pv.bullets.innerHTML = visible.map(i => `<li>${escapeHtml(i)}</li>`).join("");

        // si habia mas items, mandar a extra detalle automaticamente
        const overflowItems = items.slice(maxItems);
        if (overflowItems.length && !fields.extraDetalle.value.trim()) {
          fields.extraDetalle.value = "Items adicionales:\n- " + overflowItems.join("\n- ");
        }
      }

      function escapeHtml(str){
        return String(str)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      function applyLogo(url){
        const finalUrl = String(url || "").trim();
        [pv.logo1,pv.logo2,pv.wm1,pv.wm2,pv.miniBrandLogo].forEach(img=>{
          img.src = finalUrl || "https://iili.io/qFelkJt.jpg";
        });
      }

      function setObsLines(){
        // prioridad: obs1/2/3; si faltan, usa resumen partido
        const o1 = fields.obs1.value.trim();
        const o2 = fields.obs2.value.trim();
        const o3 = fields.obs3.value.trim();

        if (o1 || o2 || o3){
          pv.obsLine1.textContent = o1;
          pv.obsLine2.textContent = o2;
          pv.obsLine3.textContent = o3;
          return;
        }

        const lines = splitLines(fields.obsResumen.value);
        pv.obsLine1.textContent = lines[0] || "";
        pv.obsLine2.textContent = lines[1] || "";
        pv.obsLine3.textContent = lines[2] || "";
      }

      function applyDocType(){
        const isTec = fields.docTypeFriendly.value === "tecnico";
        $("serviceHeadText").textContent = isTec
          ? "DETALLE TECNICO / ALCANCE / ITEMS"
          : "DETALLE DEL SERVICIO / ALCANCE";

        // microcopy en encabezado
        $("pvMicro").textContent = isTec
          ? "PROPUESTA COMERCIAL / BOLETA TECNICA"
          : "PROPUESTA COMERCIAL / PRESUPUESTO FORMAL";
      }

      function applyCompactVisual(){
        const mode = fields.compactMode.value;
        // ajustes suaves sobre hoja 1 para forzar 1 pagina sin romper diseño
        if (mode === "compact"){
          pv.sheetInner1.style.gap = "5px";
          pv.sheet1.querySelector(".sheet-inner").style.padding = "7mm 7mm 6mm";
          pv.footerClose1.style.gap = "4px";
        } else if (mode === "normal"){
          pv.sheetInner1.style.gap = "8px";
          pv.sheet1.querySelector(".sheet-inner").style.padding = "8.5mm 8.5mm 7.5mm";
          pv.footerClose1.style.gap = "6px";
        } else {
          pv.sheetInner1.style.gap = "7px";
          pv.sheet1.querySelector(".sheet-inner").style.padding = "8mm 8mm 7mm";
          pv.footerClose1.style.gap = "5px";
        }
      }

      function applyWatermark(){
        const show = fields.watermarkToggle.value === "on";
        pv.watermark1.style.display = show ? "flex" : "none";
        pv.watermark2.style.display = show ? "flex" : "none";
      }

      function renderMain(){
        applyLogo(fields.logoUrl.value);
        applyDocType();
        applyCompactVisual();
        applyWatermark();

        const t = safeText(fields.tituloDoc.value, "Presupuesto");
        pv.titulo1.textContent = upperSafe(t);
        pv.titulo2.textContent = upperSafe(t);

        pv.fecha.textContent = safeText(fields.fecha.value, "DD/MM/AAAA");
        pv.nro.textContent = safeText(fields.nro.value, "-");
        pv.nro2.textContent = safeText(fields.nro.value, "-");
        pv.cliente.textContent = upperSafe(safeText(fields.cliente.value, "Cliente"));
        pv.cliente2.textContent = upperSafe(safeText(fields.cliente.value, "Cliente"));
        pv.inversion.textContent = safeText(fields.inversion.value, "$ 0");
        pv.servicioTitulo.textContent = upperSafe(safeText(fields.servicioTitulo.value, "Servicio"));
        pv.valorServicio.textContent = safeText(fields.valorServicio.value, "$ 0");

        pv.tiempo.textContent = safeText(fields.tiempo.value, "-");
        pv.vigencia.textContent = safeText(fields.vigencia.value, "-");

        pv.modalidad.textContent = safeText(fields.modalidad.value, "-");
        pv.modalidad2.textContent = safeText(fields.modalidad.value, "-");
        pv.whatsapp.textContent = safeText(fields.whatsapp.value, "-");
        pv.whatsapp2.textContent = safeText(fields.whatsapp.value, "-");
        pv.instagram.textContent = safeText(fields.instagram.value, "-");
        pv.instagram2.textContent = safeText(fields.instagram.value, "-");
        pv.legal.textContent = safeText(fields.legal.value, "-");
        pv.legal2.textContent = safeText(fields.legal.value, "-");
        pv.firma.textContent = safeText(fields.firma.value, "");
        pv.firma2.textContent = safeText(fields.firma.value, "");

        applyBullets();
        setObsLines();

        const extra = fields.extraDetalle.value.trim();
        pv.extraDetalle.textContent = extra || "Sin detalle extra.";
      }

      function estimateOverflow() {
        // chequeo simple y practico (sin volverse tecnico)
        const inner = pv.sheetInner1;
        const total = inner.scrollHeight;
        const visible = inner.clientHeight;
        return total > visible + 2;
      }

      function updatePagesMode() {
        const mode = fields.sheetMode.value; // auto | one | two
        const extra = fields.extraDetalle.value.trim();
        const hasExtra = !!extra;
        const overflow = estimateOverflow();

        let showSecond = false;
        let badge = "";
        let status = "";
        let statusType = "ok";

        if (mode === "two") {
          showSecond = hasExtra;
          badge = showSecond ? "2 paginas (manual)" : "1 pagina (manual 2, sin extra)";
          status = showSecond
            ? "Modo 2 paginas activo. Se muestra hoja 2 con detalle tecnico."
            : "Modo 2 paginas activo, pero no hay detalle tecnico extra. Solo sale 1 hoja.";
          statusType = "ok";
        } else if (mode === "one") {
          showSecond = false;
          badge = "1 pagina (forzada)";
          if (overflow) {
            status = "Atencion: el contenido excede 1 hoja. Resumi texto o usa 'Permitir 2 paginas'.";
            statusType = "warn";
          } else {
            status = "1 pagina forzada OK.";
            statusType = "ok";
          }
        } else {
          // auto
          if (overflow) {
            if (hasExtra) {
              showSecond = true;
              badge = "2 paginas (auto)";
              status = "El contenido excede 1 hoja. Se habilito hoja 2 automaticamente.";
              statusType = "warn";
            } else {
              showSecond = false;
              badge = "1 pagina (auto, excedida)";
              status = "El contenido esta largo para 1 hoja. Agrega detalle extra y cambia a 2 paginas, o resume.";
              statusType = "warn";
            }
          } else {
            showSecond = false;
            badge = "1 pagina (auto)";
            status = "Todo entra en 1 hoja correctamente.";
            statusType = "ok";
          }
        }

        pv.sheet2.style.display = showSecond ? "" : "none";
        pv.badgeMode.textContent = badge;
        pv.dotMode.style.background = statusType === "warn" ? "var(--warn)" : "var(--ok)";
        setStatus(status, statusType);
      }

      function renderAll(){
        renderMain();
        // doble render por layout / fuentes / imágenes
        requestAnimationFrame(() => {
          updatePagesMode();
        });
      }

      function bindAll(){
        Object.values(fields).forEach(el => {
          el.addEventListener("input", renderAll);
          el.addEventListener("change", renderAll);
        });

        pv.advPanel.addEventListener("toggle", () => {
          pv.advLabel.textContent = pv.advPanel.open ? "cerrar" : "abrir";
        });

        btnPrint.addEventListener("click", () => {
          renderAll();
          setTimeout(() => window.print(), 120);
        });

        btnShare.addEventListener("click", async () => {
          try{
            if (!navigator.share){
              setStatus("Tu navegador no soporta compartir directo. Usa 'Imprimir / Guardar PDF'.", "warn");
              return;
            }
            await navigator.share({
              title: "Generador de Presupuesto CIBORG347",
              text: "Te comparto el generador de presupuesto / boleta PDF (Modo CIBORG)."
            });
            setStatus("Compartido correctamente.", "ok");
          }catch(err){
            if (err && err.name === "AbortError") {
              setStatus("Compartir cancelado.", "warn");
            } else {
              setStatus("No se pudo compartir desde este dispositivo.", "warn");
            }
          }
        });

        btnDownloadHtml.addEventListener("click", () => {
          try{
            const html = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
            const blob = new Blob([html], {type:"text/html;charset=utf-8"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "ciborg347-generador-presupuestos.html";
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
            setStatus("HTML descargado.", "ok");
          }catch(e){
            setStatus("No se pudo descargar el HTML.", "err");
          }
        });

        btnReset.addEventListener("click", () => {
          Object.keys(fields).forEach(k => fields[k].value = defaults[k]);
          renderAll();
          setStatus("Campos restablecidos.", "ok");
        });

        btnLoadCiborg.addEventListener("click", () => {
          // plantilla base CIBORG (deja lista una boleta pro)
          fields.docTypeFriendly.value = "tecnico";
          fields.tituloDoc.value = "Presupuesto";
          fields.sheetMode.value = "auto";
          fields.compactMode.value = "smart";
          fields.watermarkToggle.value = "on";
          fields.modalidad.value = "Se abona una vez entregado el sitio / transferencia o MP";
          fields.whatsapp.value = "11 6449-9481";
          fields.instagram.value = "@ciborg347";
          fields.legal.value = "Esta propuesta puede ajustarse segun cambios de alcance, contenido o funcionalidades solicitadas.";
          fields.firma.value = "CIBORG347 // DISENO QUE CONVIERTE VISITAS EN CLIENTES";
          renderAll();
          setStatus("Plantilla Modo CIBORG aplicada.", "ok");
        });

        // si carga imagen tarde, recalcula
        [pv.logo1,pv.wm1,pv.logo2,pv.wm2].forEach(img=>{
          img.addEventListener("load", () => renderAll());
          img.addEventListener("error", () => setStatus("No se pudo cargar la imagen/logo. Revisa la URL.", "warn"));
        });

        // recalcular en resize
        window.addEventListener("resize", () => {
          clearTimeout(window.__rzTimer);
          window.__rzTimer = setTimeout(renderAll, 120);
        });
      }

      // init
      bindAll();
      renderAll();
      setTimeout(renderAll, 500); // por fonts/layout
    })();
  </script>
</body>
</html>
